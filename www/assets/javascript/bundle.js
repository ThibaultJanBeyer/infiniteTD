"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function init(){setupScoreboard(),setupPlayer(),setupBoard(),setupTowers(),setupGretel(),setupAudio(),setupExtraInfo(),setSizes(),b.onresize=function(){setSizes()},w.addEventListener("orientationchange",function(){setSizes()})}function handleFieldClick(e,t){var i=builders,n=scoreboard;if(e.position(),e.locked)if("tower"===e.locked)checkWhichTowerToOpen(e,i,n);else if(!e.start&&!e.end||builderOpen){for(var r in i)if(i.hasOwnProperty(r)&&i[r].selectedField){var o=i[r];o.hide(),o.upgrading||generalPause||!isStarted||n.togglePlay()}t.preventDefault()}else audio.play("do_not_block");else e.openBuilder(i.towers)}function checkWhichTowerToOpen(e,t,i){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];e.tower.name==="tower__"+n&&e.openBuilder(r,!0)}}function setupBoard(){var e=0,t=0;board=createElement("div","board");for(var i=0,n=boardSize;i<n;i++)fields[i]=new Field(i),fields[i].fX=e,fields[i].fY=t,e<boardRowSize-1?e++:(e=0,t++),i===startFieldP?(fields[i].lock("start"),startField=fields[i]):i===endFieldP-1&&(fields[i].lock("end"),endField=fields[i]),board.appendChild(fields[i].e);g.appendChild(board);for(var r=fields.length;r--;)fields[r].position();for(var o=0,s=boardRowSize;o<s;o++)topFields.push(o),leftFields.push(o*boardRowSize),bottomFields.push(o+boardSize-boardRowSize),rightFields.push(boardRowSize+o*boardRowSize-1);b.addEventListener("click",function(e){e.stopPropagation(),globalClick(e)}),d.addEventListener("keyup",function(e){globalKeyboard(e)}),creepContainer=createElement("div","creep-container"),projectileContainer=createElement("div","projectile-container"),bountyContainer=createElement("div","bounty-container"),livesContainer=createElement("div","lives-container"),scoreboard.money.up=[],scoreboard.money.up2=[],scoreboard.money.down=[],scoreboard.money.down2=[];for(var a=20;a--;)scoreboard.money.up[a]=createElement("span","animation__gainmoney animation__gainmoney--scoreboard"),scoreboard.money.up2[a]=createElement("span","animation__gainmoney"),scoreboard.money.down[a]=createElement("span","animation__losemoney animation__losemoney--scoreboard"),scoreboard.money.down2[a]=createElement("span","animation__losemoney"),appendChilds(scoreboard.money.generalHolder,[scoreboard.money.up[a],scoreboard.money.down[a]]),appendChilds(bountyContainer,[scoreboard.money.up2[a],scoreboard.money.down2[a]]);scoreboard.lives.up=[],scoreboard.lives.up2=[],scoreboard.lives.down=[],scoreboard.lives.down2=[];for(var l=20;l--;)scoreboard.lives.up[l]=createElement("span","animation__gainlives animation__gainlives--scoreboard","+1"),scoreboard.lives.up2[l]=createElement("span","animation__gainlives","+1"),scoreboard.lives.down[l]=createElement("span","animation__loselives animation__loselives--scoreboard","-1"),scoreboard.lives.down2[l]=createElement("span","animation__loselives","-1"),appendChilds(scoreboard.lives.holder,[scoreboard.lives.up[l],scoreboard.lives.down[l]]),appendChilds(livesContainer,[scoreboard.lives.up2[l],scoreboard.lives.down2[l]]);appendChilds(board,[creepContainer,projectileContainer,bountyContainer,livesContainer])}function globalClick(e){var t=builders,i=scoreboard;for(var n in t)if(t.hasOwnProperty(n)&&t[n].selectedField){var r=t[n];r.hide(),r.upgrading||generalPause||!isStarted||i.togglePlay()}}function globalKeyboard(e){var t=e.keyCode||e.key;if(80===t||"p"===t){if(builderOpen)for(var i in builders)builders.hasOwnProperty(i)&&builders[i].selectedField&&builders[i].hide();!generalPause&&isStarted?(generalPause=!generalPause,scoreboard.togglePlay()):scoreboard.togglePlay()}}function setSizes(){if(wX=b.offsetWidth-10,wY=b.offsetHeight-10,wX>wY){board.style.width=wY-scoreboard.e.offsetWidth+"px",board.style.height=wY-scoreboard.e.offsetWidth+"px",scoreboard.elements.forEach(function(e){removeClass(e,"scoreboard__el--alt")}),removeClass(scoreboard.e,"scoreboard--alt"),removeClass(board,"board--alt");for(var e=fields.length;e--;)fields[e].e.style.width=board.clientWidth/10+"px",fields[e].e.style.height=board.clientHeight/10+"px"}else{board.style.width=wX-scoreboard.e.offsetHeight+"px",board.style.height=wX-scoreboard.e.offsetHeight+"px",scoreboard.elements.forEach(function(e){addClass(e,"scoreboard__el--alt")}),addClass(scoreboard.e,"scoreboard--alt"),addClass(board,"board--alt");for(var t=fields.length;t--;)fields[t].e.style.width=board.clientWidth/10+"px",fields[t].e.style.height=board.clientHeight/10+"px"}for(var i=fields.length;i--;)fields[i].position();for(var n=allTowers.length;n--;)allTowers[n].update();for(var r=allProjectiles.length;r--;)allProjectiles[r].update()}function useBoardWithKey(e,t){var i={0:{field:fields[e.pos+1],edge:rightFields.indexOf(e.pos)>-1},1:{field:fields[e.pos-1],edge:leftFields.indexOf(e.pos)>-1},2:{field:fields[e.pos-boardRowSize],edge:topFields.indexOf(e.pos)>-1},3:{field:fields[e.pos+boardRowSize],edge:bottomFields.indexOf(e.pos)>-1}},n=t.keyCode||t.key;keyboardBasicMovement(n,i),keyboardEscape(n)}function keyboardBasicMovement(e,t){for(var i=[[39,"ArrowRight"],[37,"ArrowLeft"],[38,"ArrowUp"],[40,"ArrowDown"]],n=i.length;n--;)e!==i[n][0]&&e!==i[n][1]||t[n].edge||t[n].field.e.focus()}function keyboardEscape(e){var t=builders,i=scoreboard;if(27===e||"Escape"===e){for(var n in t)t.hasOwnProperty(n)&&t[n].hide();i.play.focus()}}function userBuilderWithKey(e,t){var i=t.keyCode||t.key;27!==i&&"Escape"!==i||(e.selectedField.e.focus(),e.hide())}function setupExtraInfo(){extraInfo=new ExtraInfo}function animateScore(e){for(var t=e.length;t--;){var i=e[t][0]?e[t][0]:e[t],n=e[t][1]?e[t][1]:0;i.style.visibility="visible",n.x&&(i.style.left=n.x+"px",i.style.top=n.y+"px"),setVendor(i,transform,"translate3d(0, -300%, 1px)"),i.style.opacity=0}}function recycleAnimation(e){for(var t=e.length;t--;){var i=e[t];i.style.visibility="hidden",setVendor(i,transform,"translate3d(0, 0, 1px)"),i.style.opacity=1}}function moveObj(e,t){var i=void 0;return isPaused||(e.dist={x:t.x-e.x,y:t.y-e.y},i=calculateIncrement(e,t),e.x+=i.x,e.y+=i.y,e.visual.x+=i.x,e.visual.y+=i.y,setVendor(e,transform,"translate3d("+e.visual.x+"px,"+e.visual.y+"px, 1px)")),Math.abs(e.dist.x)<10&&Math.abs(e.dist.y)<10}function calculateIncrement(e,t){var i={};e.follow&&(e.dist={x:t.x-e.x,y:t.y-e.y});var n=Math.abs(e.dist.x),r=Math.abs(e.dist.y),o=n/e.ms,s=r/e.ms;return i.x=0!==o?n/o*e.dt:0,i.y=0!==s?r/s*e.dt:0,e.dist.x<0&&(i.x*=-1),e.dist.y<0&&(i.y*=-1),i}function setVendor(e,t,i){e.style["webkit"+t]=i,e.style["moz"+t]=i,e.style["ms"+t]=i,e.style["o"+t]=i}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function createElement(e,t){var i=arguments.length<=2||void 0===arguments[2]?"":arguments[2],n=d.createElement(e);return n.className=t,n.innerHTML=i,n}function appendChilds(e,t){for(var i=0,n=t.length;i<n;i++)e.appendChild(t[i])}function myLoop(e){var t=e.cd,i=e.dur,n=e.cu,r=void 0===n?0:n,o=e.cb;o({cd:t,dur:i,cu:r}),r++,--t>=0&&setTimeout(function(){myLoop({cd:t,dur:i,cu:r,cb:o})},i)}function myInterval(e){function t(){isPaused||(--o>=0?r({countdown:o,dur:n}):clearInterval(s))}var i=e.cd,n=e.dur,r=e.cb,o=i,s=setInterval(t,n)}function euclidDistance(e,t,i,n){return Math.sqrt(Math.pow(e-t,2)+Math.pow(i-n,2))}function addClass(e,t){var i=e.className;i.indexOf(t)===-1&&(""!==i&&(t=" "+t),e.className=i+t)}function removeClass(e,t){var i=e.className;new RegExp(t+"\\b","g");i=i.replace(t,""),e.className=i}function gretel(){return grid=new PF.Grid(boardSize/10,boardSize/10),clearOlds(),finder=new PF.BestFirstFinder({heuristic:PF.Heuristic.euclidean}),path=finder.findPath(startField.fX,startField.fY,endField.fX,endField.fY,grid),path.length>0&&(handlePath(path),!0)}function clearOlds(){gretelFields=[];for(var e=fields,t=["gretel__breadcrumb","gretel__breadcrumb--top-left","gretel__breadcrumb--top-right","gretel__breadcrumb--bottom-left","gretel__breadcrumb--bottom-right","gretel__breadcrumb--bottom-right","gretel__breadcrumb--horizontal-last-left","gretel__breadcrumb--horizontal-last-right","gretel__breadcrumb--horizontal-last-top","gretel__breadcrumb--horizontal-next-bottom","gretel__breadcrumb--horizontal-next-left","gretel__breadcrumb--horizontal-next-right","gretel__breadcrumb--horizontal-next-top","gretel__breadcrumb--horizontal-next-bottom","gretel__breadcrumb--vertical-last-left","gretel__breadcrumb--vertical-last-right","gretel__breadcrumb--vertical-last-top","gretel__breadcrumb--vertical-last-bottom","gretel__breadcrumb--vertical-next-left","gretel__breadcrumb--vertical-next-right","gretel__breadcrumb--vertical-next-top","gretel__breadcrumb--vertical-next-bottom"],i=0,n=e.length;i<n;i++){for(var r=0,o=t.length;r<o;r++)e[i].e.className.indexOf(t[r])>-1&&removeClass(e[i].e,t[r]);e[i].e.className.indexOf("tower")>-1&&e[i].lock("tower"),e[i].locked&&e[i].pos!==startField.pos&&e[i].pos!==endField.pos&&"tower"===e[i].locked&&grid.setWalkableAt(e[i].fX,e[i].fY,!1)}}function handlePath(e){for(var t=void 0,i=fields,n=0,r=e.length;n<r;n++){var o=getFields(n,e),s=checkFields(o);t="";for(var a=0,l=s.length;a<l;a++)if(s[a][0]){t=s[a][1];break}for(var c=0,d=i.length;c<d;c++)i[c].fX===e[n][0]&&i[c].fY===e[n][1]&&(i[c].e.className+=" gretel__breadcrumb "+t,gretelFields.push(i[c]))}gretelFields.push({x:endField.x+endField.w/3,y:endField.y})}function getFields(e,t){return{x:{current:t[e][0],last:t[e-1]?t[e-1][0]:null,next:t[e+1]?t[e+1][0]:null},y:{current:t[e][1],last:t[e-1]?t[e-1][1]:null,next:t[e+1]?t[e+1][1]:null}}}function checkFields(e){return[[e.y.current>e.y.next&&e.y.current===e.y.last&&e.x.current>e.x.last&&e.x.current===e.x.next||e.y.current===e.y.next&&e.y.current>e.y.last&&e.x.current===e.x.last&&e.x.current>e.x.next,"gretel__breadcrumb--bottom-right"],[e.y.current===e.y.next&&e.y.current<e.y.last&&e.x.current===e.x.last&&e.x.current<e.x.next||e.y.current<e.y.next&&e.y.current===e.y.last&&e.x.current<e.x.last&&e.x.current===e.x.next,"gretel__breadcrumb--top-left"],[e.y.current<e.y.next&&e.y.current===e.y.last&&e.x.current>e.x.last&&e.x.current===e.x.next||e.y.current===e.y.next&&e.y.current<e.y.last&&e.x.current===e.x.last&&e.x.current>e.x.next||e.y.current<e.y.next&&e.y.current===e.y.last&&e.x.current<e.x.last&&e.x.current===e.x.next,"gretel__breadcrumb--top-right"],[e.y.current===e.y.next&&e.y.current>e.y.last&&e.x.current===e.x.last&&e.x.current<e.x.next||e.y.current>e.y.next&&e.y.current===e.y.last&&e.x.current<e.x.last&&e.x.current===e.x.next,"gretel__breadcrumb--bottom-left"],[e.x.current<e.x.next&&e.y.current===e.y.next,"gretel__breadcrumb--horizontal-next-right"],[e.x.current<e.x.last&&e.y.current===e.y.last,"gretel__breadcrumb--horizontal-last-right"],[e.x.current>e.x.next&&e.y.current===e.y.next,"gretel__breadcrumb--horizontal-next-left"],[e.x.current>e.x.last&&e.y.current===e.y.last,"gretel__breadcrumb--horizontal-last-left"],[e.x.current===e.x.next&&e.y.current<e.y.next,"gretel__breadcrumb--vertical-next-top"],[e.x.current===e.x.last&&e.y.current>e.y.last,"gretel__breadcrumb--vertical-last-top"],[e.x.current===e.x.next&&e.y.current>e.y.next,"gretel__breadcrumb--vertical-next-bottom"],[e.x.current===e.x.last&&e.y.current<e.y.last,"gretel__breadcrumb--vertical-last-bottom"]]}function setupGretel(){gretel()}function setupScoreboard(){scoreboard=new Scoreboard}function setupAudio(){audio=new Audio}function createSVG(e){var t=e.containerClass,i=void 0===t?"scoreboard__el":t,n=e.container,r=void 0===n?"div":n,o=e.svg,s=e.svgName,a=e.extraElement,l=void 0!==a&&a,c={};return c.container=createElement(r,i+" "+i+"-"+s,o),l&&(c[l]=createElement(l,i+"-"+l),c.container.appendChild(c[l])),c}function nextLevel(){for(var e=holders.length;e--;)holders[e].innerHTML="";creepContainer.innerHTML="",allCreeps=[],setTimeout(function(){recycleAnimation(recyclings);for(var e=[],t=0,i=levels[p1.level].amount;t<i;t++){var n=new Creeps({ms:levels[p1.level].creeps.ms,hp:levels[p1.level].creeps.hp,lvl:p1.level,bounty:levels[p1.level].creeps.bounty});e.push(n)}myInterval({cd:e.length,dur:500,cb:function(t){var i=t.countdown;e[i].setup(),allCreeps.push(e[i])}})},1e3)}function setupPlayer(){p1=new Player({name:"Player 1",money:100,level:0,score:0,lives:10}),scoreboard.update(p1)}function lost(){lostGame=!0,isPaused=!0,creepContainer.innerHTML="",allCreeps=[];for(var e=board.querySelectorAll(".t"),t=e.length;t--;)e[t].className="board__field";audio.play("you_lost_try_again")}function setupTowers(){tBasic=new BasicTower,tRock=new RockTower,tSell=new SellTower,builders.towers=new Builder([tBasic,tRock]),builders.basic=new Builder([tSell]),builders.rock=new Builder([tSell])}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),d=document,b=d.body,g=d.getElementsByClassName("infiniteTD")[0],w=window,wX=void 0,wY=void 0,isPaused=!0,isStarted=!1,generalPause=!1,lostGame=!1,isDevice=!1;document.addEventListener("deviceready",function(){AndroidFullScreen.immersiveMode(),getWindow().addFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON),isDevice=!0,init()},!1),function(){setTimeout(function(){isDevice||init()},2e3)}(),window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var time=(new Date).getTime();!function e(){requestAnimationFrame(e);var t=(new Date).getTime(),i=t-time;if(time=t,!isPaused){for(var n=allCreeps.length;n--;)allCreeps[n]&&allCreeps[n].nextLocation(i);for(var r=readyProjectiles.length;r--;)readyProjectiles[r].attack(i);for(var o=allAttackTowers.length;o--;)allAttackTowers[o].scan(i)}}();for(var Field=function(){function e(t){var i=this;_classCallCheck(this,e),this.e=createElement("button","board__field"),this.locked=!1,this.start=!1,this.end=!1,this.pos=t,this.e.addEventListener("click",function(e){e.stopPropagation(),handleFieldClick(i,e)}),this.e.addEventListener("keyup",function(e){useBoardWithKey(i,e)})}return _createClass(e,[{key:"lock",value:function(e){this.locked=!e||e,addClass(this.e,"locked"),"start"===e?(addClass(this.e,"start"),this.start=!0):"end"===e&&(addClass(this.e,"end"),this.end=!0)}},{key:"unlock",value:function(){this.start||this.end||(this.locked=!1,removeClass(this.e,"locked"))}},{key:"position",value:function(){this.w=this.e.offsetWidth,this.h=this.e.offsetHeight,this.x=this.fX*this.w,this.y=this.fY*this.h}},{key:"openBuilder",value:function(e,t){if(builderOpen){var i=builders,n=scoreboard;for(var r in i)if(i.hasOwnProperty(r)&&i[r].selectedField){var o=i[r];o.hide(),o.upgrading||generalPause||!isStarted||n.togglePlay()}builderOpen=!1}else builderOpen=!0,e.draw(this,t),e.towerOptionE[0].focus()}},{key:"buildTower",value:function(e){"basic"===e.name?(this.tower=new BasicTower,this.tower.setup(this)):"rock"===e.name&&(this.tower=new RockTower,this.tower.setup(this)),this.e.className+=" tower "+e.name,this.e.setAttribute("data-level",e.level),this.lock("tower"),this.e.className.indexOf("gretel__breadcrumb")>-1&&removeClass(this.e,"gretel__breadcrumb"),gretel()}},{key:"destroyTower",value:function(){removeClass(this.e,"tower"),removeClass(this.e,this.tower.name),this.e.removeAttribute("data-level"),this.unlock(),this.tower=0}}]),e}(),board=void 0,creepContainer=void 0,projectileContainer=void 0,bountyContainer=void 0,livesContainer=void 0,fields=[],startField=void 0,endField=void 0,topFields=[],rightFields=[],bottomFields=[],leftFields=[],boardSize=100,boardRowSize=boardSize/10,startFieldP=boardSize/2-boardRowSize,endFieldP=boardSize/2,builderOpen=!1,Builder=function(){function e(t){var i=this;_classCallCheck(this,e),this.selectedField=!1,this.e=createElement("div","selector"),this.e.addEventListener("click",function(e){e.stopPropagation(),i.hide()}),this.towerContainerE=[],this.towerOptionE=[],this.towerPriceE=[],this.towerInfoE=[];for(var n=function(e,n){var r=t[n],o=createElement("div","selector__container "+r.name);i.towerContainerE.push(o);var s=createElement("button","selector__element "+r.name+"-name",r.nameOg);i.towerOptionE.push(s);var a=createElement("span","selector__info "+r.name+"-price",r.cost+"$");i.towerPriceE.push(a);var l=createElement("button","selector__info "+r.name+"-showinfo","?");i.towerInfoE.push(a),l.addEventListener("click",function(e){e.stopPropagation(),"sell"===r.name?extraInfo.upgrade(r):extraInfo.tower(r)}),s.addEventListener("click",function(e){e.stopPropagation(),i.build(r,i.selectedField)}),s.appendChild(a),appendChilds(o,[s,l]),i.e.appendChild(o)},r=0,o=t.length;r<o;r++)n(o,r);board.appendChild(this.e),this.range=createElement("div","tower__range"),this.range.addEventListener("click",function(e){e.stopPropagation(),i.hide()}),board.appendChild(this.range),this.e.addEventListener("keyup",function(e){userBuilderWithKey(i,e)})}return _createClass(e,[{key:"draw",value:function(e,t){if(this.selectedField=e,this.selectedField.builder=this,e.builder=this,t){this.upgrading=!0;var i=2*e.tower.rng-10;this.range.style.width=i+"px",this.range.style.height=i+"px",this.range.style.left=e.x+e.w/2+"px",this.range.style.top=e.y+e.w/2+"px",this.range.className="tower__range tower__range--show"}else this.upgrading=!1,e.lock("tower"),!generalPause&&isStarted&&scoreboard.togglePlay();if(gretel()){this.upgrading||e.unlock(),this.w=2*e.w+"px",this.h=2*e.w+"px",this.e.className="selector selector--show",this.e.style.width=this.w,this.e.style.height=this.h;var n=[e.x-e.w/2,e.y-e.w/2];parseInt(this.w)<=90&&(n=[e.x-35,e.y-35]),this.e.style.left=n[0]+"px",this.e.style.top=n[1]+"px"}else this.upgrading||e.unlock(),audio.play("do_not_block"),this.hide()}},{key:"hide",value:function(){!(arguments.length<=0||void 0===arguments[0])&&arguments[0];this.selectedField&&(this.selectedField.builder=!1,this.selectedField=!1),this.e.className="selector",this.range.className="tower__range",builderOpen=!1,gretel()}},{key:"build",value:function(e,t){this.hide(),this.upgrading||!generalPause&&isStarted&&scoreboard.togglePlay(),"tower__sell"===e.name?(p1.updateMoney(t.tower.cost/2,t),t.destroyTower(),t.e.focus()):p1.money<e.cost?audio.play("need_more_money"):t.locked?audio.play("cannot_build_here"):(p1.updateMoney(e.cost*-1,t),t.buildTower(e),t.e.focus())}}]),e}(),allCreeps=[],Creeps=function(){function e(t){var i=t.ms,n=t.hp,r=t.lvl,o=t.bounty;_classCallCheck(this,e),this.e=createElement("div","c c__l"+r),this.bounty={value:o,creep:createElement("span","animation__gainmoney","+"+o),money:createElement("span","animation__gainmoney animation__gainmoney--scoreboard","+"+o),score:createElement("span","animation__gainscore animation__gainscore--scoreboard","+"+o)},bountyContainer.appendChild(this.bounty.creep),scoreboard.money.holder.appendChild(this.bounty.money),scoreboard.score.holder.appendChild(this.bounty.score),this.ms=i,this.hp=n,this.fullHp=n,this.lasts=[],this.tolerance=5,this.i=0,creepContainer.appendChild(this.e),this.e.style.left=startField.x+"px",this.e.style.top=startField.y+"px",this.e.style.opacity=0,this.x=parseInt(this.e.style.left),this.y=parseInt(this.e.style.top),this.visual={x:0,y:0},this.invulnerable=!0}return _createClass(e,[{key:"setup",value:function(){this.e.style.opacity=1,this.invulnerable=!1}},{key:"damage",value:function(e){this.hp-=e,this.e.style.opacity=this.hp/this.fullHp,this.hp<=0&&this.remove(!0,p1)}},{key:"remove",value:function(e,t){this.dead||(this.dead=!0,e&&t.unitKill(this),this.e.style.opacity=0,kills++,kills>=levels[p1.level].amount&&(kills=0,p1.levelUp()))}},{key:"nextLocation",value:function(e){if(!this.dead){var t=gretelFields;this.i<t.length?(this.dt=e,moveObj(this,t[this.i])&&this.i++):(p1.updateLives(-1),this.remove())}}}]),e}(),extraInfo=void 0,ExtraInfo=function(){function e(){_classCallCheck(this,e),this.wrapper=createElement("div","dialog"),this.wrapper.setAttribute("aria-hidden","true"),this.backdrop=createElement("div","dialog-overlay"),this.backdrop.setAttribute("tabindex","-1"),this.backdrop.setAttribute("data-a11y-dialog-hide","true"),this.container=d.createElement("div"),this.container.setAttribute("role","dialog"),this.e=createElement("div","dialog-content"),this.e.setAttribute("role","document"),this.cont={},this.close=createElement("button","dialog-close","&times;"),this.close.setAttribute("type","button"),this.close.setAttribute("data-a11y-dialog-hide","true"),this.close.setAttribute("aria-label","Close this dialog window"),appendChilds(this.container,[this.e,this.close]),appendChilds(this.wrapper,[this.backdrop,this.container]),b.appendChild(this.wrapper),this.dialog=new A11yDialog(this.wrapper)}return _createClass(e,[{key:"tower",value:function(e){this.e.innerHTML="";var t=["cost"];0!==e.level&&t.push("level"),0!==e.dmg&&t.push("dmg"),0!==e.cd&&t.push("cd"),this.cont.floatsContainer=d.createElement("div");for(var i=0,n=t.length;i<n;i++){var r=t[i],o=e[t[i]],s="";"cost"===t[i]?s=" $":"dmg"===t[i]?r="damage":"cd"===t[i]&&(r="cooldown",s=" sec",o=e[t[i]]/1e3),this.cont[t[i]]=createElement("div","extra-info__"+t[i]),this.cont[t[i]].text=createElement("div","extra-info__"+t[i]+"-text",r+":"),this.cont[t[i]].val=createElement("div","extra-info__"+t[i]+"-value",""+o+s),appendChilds(this.cont[t[i]],[this.cont[t[i]].text,this.cont[t[i]].val]),this.cont.floatsContainer.appendChild(this.cont[t[i]])}this.cont.container=createElement("div","extra-info__container"),this.cont.container.style.maxHeight=.8*wY+"px",this.cont.imgContainer=createElement("div","extra-info__img-container"),this.cont.img=createElement("img","extra-info__img"),this.cont.img.setAttribute("src","assets/img/"+e.nameOg+".gif"),this.cont.img.setAttribute("aria-hidden","true"),this.cont.imgContainer.appendChild(this.cont.img),this.cont.title=createElement("h1","extra-info__title",capitalizeFirstLetter(e.nameOg)),this.cont.description=createElement("p","extra-info__description",e.description),appendChilds(this.cont.container,[this.cont.imgContainer,this.cont.title,this.cont.description]),appendChilds(this.e,[this.cont.floatsContainer,this.cont.container]),this.dialog.show()}}]),e}(),gretelFields=[],grid=void 0,finder=void 0,path=void 0,scoreboard=void 0,sounds={resources:[["assets/sounds/sprite.ogg","audio/mp3"],["assets/sounds/sprite.mp3","audio/ogg"]],spritemap:{cannot_build_here:{start:0,end:1.3,loop:!1},do_not_block:{start:3,end:4,loop:!1},finish_building_process_first:{start:5,end:7.1,loop:!1},need_more_money:{start:9,end:10.2,loop:!1},winner_winner_chicken_dinner:{start:12,end:13.5,loop:!1},you_lost_try_again:{start:15,end:17.3,loop:!1}}},audio=void 0,soundOff=!1,holders=[],recyclings=[],Scoreboard=function(){function e(){var t=this;_classCallCheck(this,e),this.e=createElement("div","scoreboard"),this.player=createSVG({svgName:"player",extraElement:"input",svg:SVGplayer}),this.player.input.setAttribute("aria-label","Player name: "),this.money=createSVG({svgName:"money",extraElement:"p",svg:SVGmoney}),this.money.holder=d.createElement("div"),holders.push(this.money.holder),this.money.generalHolder=d.createElement("div"),appendChilds(this.money.container,[this.money.holder,this.money.generalHolder]),this.level=createSVG({svgName:"level",extraElement:"p",svg:SVGlevel}),this.level.holder=d.createElement("div"),this.level.up=createElement("span","animation__levelup animation__levelup--scoreboard","+1"),this.level.holder.appendChild(this.level.up),this.level.container.appendChild(this.level.holder),recyclings.push(this.level.up),this.score=createSVG({svgName:"score",extraElement:"p",svg:SVGscore}),this.score.holder=d.createElement("div"),this.score.container.appendChild(this.score.holder),holders.push(this.score.holder),this.lives=createSVG({svgName:"lives",extraElement:"p",svg:SVGlives}),this.lives.holder=d.createElement("div"),this.lives.container.appendChild(this.lives.holder),this.controls=createElement("div","scoreboard__el-controls"),this.play=createElement("button","scoreboard__el scoreboard__el-pause","play"),this.audioOff=createSVG({container:"button",svgName:"audio",svg:SVGaudio.off}),this.audioOn=createSVG({container:"button",svgName:"audio",svg:SVGaudio.on}),this.audioOn.container.style.display="none",appendChilds(this.controls,[this.play,this.audioOff.container,this.audioOn.container]),this.m=createElement("p","scoreboard__el scoreboard__el-message","."),this.play.addEventListener("click",function(e){e.stopPropagation(),isStarted?(isPaused===!0&&(generalPause=!0),generalPause=!generalPause):(setSizes(),generalPause=!1);for(var i in builders)builders.hasOwnProperty(i)&&builders[i].hide(!0);t.togglePlay(),generalPause&&(isPaused=!0)}),this.audioOn.container.addEventListener("click",function(e){e.stopPropagation(),t.toggleAudio()}),this.audioOff.container.addEventListener("click",function(e){e.stopPropagation(),t.toggleAudio()}),this.player.input.addEventListener("keyup",function(e){var i=e.keyCode||e.key;e.stopPropagation(),13===i||"Enter"===i?g.focus():t.playerName(p1)}),this.player.input.addEventListener("focus",function(){addClass(t.player.container,"scoreboard__hint"),t.player.input.select()}),this.player.input.addEventListener("blur",function(){removeClass(t.player.container,"scoreboard__hint")}),this.elements=[this.player.container,this.money.container,this.score.container,this.lives.container,this.level.container,this.controls,this.m],appendChilds(this.e,this.elements),g.appendChild(this.e),setTimeout(function(){t.player.input.select()},100)}return _createClass(e,[{key:"update",value:function(e){this.player.input.value=e.name,this.money.p.innerHTML=Math.floor(e.money),this.level.p.innerHTML=Math.floor(e.level),this.score.p.innerHTML=Math.floor(e.score),this.lives.p.innerHTML=Math.floor(e.lives)}},{key:"message",value:function(e,t){var i=this;this.m.style.display="block",this.m.innerHTML=e,this.m.className+=" scoreboard__el--flash",setTimeout(function(){removeClass(i.m,"scoreboard__el--flash"),setTimeout(function(){i.m.style.display="none"},1e3)},1e3*Math.floor(t)+500)}},{key:"togglePlay",value:function(){lostGame||(isStarted||(isStarted=!0,p1.levelUp()),this.play.innerHTML=isPaused?"pause":"play",isPaused=!isPaused)}},{key:"toggleAudio",value:function(){soundOff=!soundOff,soundOff?(this.audioOff.container.style.display="none",this.audioOn.container.style.display="inline-block"):(this.audioOff.container.style.display="inline-block",this.audioOn.container.style.display="none")}},{key:"playerName",value:function(e){e.name=this.player.input.value,this.update(e)}}]),e}(),Audio=function(){function e(){var t=this;_classCallCheck(this,e),this.e=createElement("audio","audio__player"),this.e.setAttribute("preload","true"),this.src=[];for(var i=sounds.resources.length;i--;)this.src[i]=d.createElement("source"),this.src[i].setAttribute("src",sounds.resources[i][0]),this.src[i].setAttribute("type",sounds.resources[i][1]),this.e.appendChild(this.src[i]);g.appendChild(this.e),this.e.addEventListener("timeupdate",function(){t.e.currentTime>t.end&&t.e.pause()},!1)}return _createClass(e,[{key:"play",value:function(e){sounds.spritemap[e]&&!soundOff?(this.e.currentTime=sounds.spritemap[e].start,this.end=sounds.spritemap[e].end,scoreboard.message(""+e.replace(/_/g," "),this.end-this.e.currentTime),this.e.play()):scoreboard.message(""+e.replace(/_/g," "),2)}}]),e}(),SVGlevel='<svg viewBox="0 0 8.1 15.9" id="level" class="scoreboard__icon scoreboard__icon--level" role="img">\n    <title>Level: </title>\n    <path role="presentation" d="M7.5 0h-6C.9 0 0 .3 0 .9v14.4s.2.4.4.5c.2.1.8-.1.8-.1l3.2-2.5 3.2 2.5s.1.2.4 0c.2-.1 0-.5 0-.5V.9C8 .3 8 0 7.5 0zM1 8.9l3-2 3 2v2l-3-2-3 2v-2zM4 12l-3 2.3v-2.4l3-2 3 2v2.4L4 12zm3-4.1l-3-2-3 2V1h6v6.9z"/>\n  </svg>',SVGlives='<svg viewBox="0 0 16 15" id="lives" class="scoreboard__icon scoreboard__icon--lives" role="img">\n    <title>Lives: </title>\n    <path role="presentation" d="M14.6 1.4C12.8-.5 9.8-.5 8 1.4 6.2-.5 3.2-.5 1.4 1.4c-1.8 1.9-1.8 4.9 0 6.8L8 15l6.6-6.8c1.9-1.9 1.9-4.9 0-6.8zm-.8 5.9l-2.2 2.2L8 13.3 4.4 9.6 2.2 7.3C.9 5.9.8 3.6 2.2 2.2c1.4-1.4 3.6-1.4 5 0L8 3l.8-.8c1.4-1.4 3.6-1.4 5 0 1.4 1.5 1.4 3.7 0 5.1z"/><path d="M11 3c-.4 0-.8.1-1.1.3l.6.8c.1 0 .3-.1.5-.1.6 0 1 .4 1 1 0 .2 0 .3-.1.4l.9.4c.1-.2.2-.5.2-.8 0-1.1-.9-2-2-2z"/>\n  </svg>',SVGmoney='<svg viewBox="0 0 16 16" id="money" class="scoreboard__icon scoreboard__icon--money" role="img">\n    <title>Money: </title>\n    <path role="presentation" d="M7.8 6.7c-.6-.3-.6-1 .4-1.1.8 0 1.6.2 2.1.4 0 0 .3-1.4.4-1.7-.8-.1-1.4-.2-2-.3v-.9H7.3v1c-1.6.3-2.2 1.5-2.2 2.3 0 2 2.4 2.4 3.1 2.7.8.4.7 1-.1 1.1-.8.2-1.9-.2-2.6-.5L5 11.4c.7.4 1.6.6 2.2.7v.9h1.5v-1c1.3-.2 2.3-1 2.3-2.4 0-1.8-1.9-2.3-3.2-2.9zM8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 15c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7z"/>\n  </svg>',SVGplayer='<svg viewBox="-404.9 509.1 15.9 15.9" id="player" class="scoreboard__icon scoreboard__icon--player" role="img">\n    <title>Player: </title>\n    <path role="presentation" d="M-394.6 518.4c1.6-.8 2.6-2.5 2.6-4.4 0-2.8-2.2-5-5-5s-5 2.2-5 5c0 1.9 1.1 3.5 2.6 4.3-2.9.9-5.2 3.6-5.5 6.6h15.8c-.3-2.9-2.5-5.6-5.5-6.5zm-6.4-4.3c0-2.2 1.8-4 4-4s4 1.8 4 4-1.8 4-4 4-4-1.8-4-4zm-2.6 9.9c.9-3 3.5-5 6.7-5s5.8 2 6.7 5h-13.4z"/>\n  </svg>',SVGscore='<svg viewBox="0 0 16 16" id="score" class="scoreboard__icon scoreboard__icon--score" role="img">\n    <title>Score: </title>\n    <path role="presentation" d="M16 6.1l-5.6-.7L8 0 5.6 5.4 0 6.1l4.1 4-1 5.9 5-2.9 5 2.9-1.1-5.8 4-4.1zm-8 5.5l-3.2 1.9.7-3.8L2.8 7l3.7-.5L8 3l1.6 3.5 3.6.5-2.7 2.6.7 3.8L8 11.6z"/>\n  </svg>',SVGaudio={off:'<svg viewBox="0 0 612 792" id="audio-false" class="scoreboard__icon scoreboard__icon--audio" role="img">\n          <title>Disable Audio: </title>\n          <path role="presentation" d="M153 281.2H38.2c-23 0-38.2 15.3-38.2 38.2v153c0 23 15.3 38.2 38.2 38.2H153l153 153h38.2V128.2H306l-153 153zm153 325.2L172.1 472.5H38.2v-153h133.9L306 185.6v420.8zM604.4 430.4l-53.5-53.6 53.5-53.6c7.6-7.6 7.6-19.1 0-26.8l-7.7-7.6c-7.6-7.6-19.1-7.6-26.8 0l-53.5 53.5-53.6-53.5c-7.6-7.6-19.1-7.6-26.8 0l-7.6 7.6c-7.6 7.6-7.6 19.1 0 26.8l53.5 53.6-53.5 53.6c-7.6 7.6-7.6 19.1 0 26.8l7.6 7.6c7.6 7.6 19.1 7.6 26.8 0l53.6-53.5 53.5 53.5c7.6 7.6 19.1 7.6 26.8 0l7.7-7.6c7.6-7.7 7.6-19.1 0-26.8z"/>\n        </svg>',on:'<svg viewBox="0 0 612 792" id="audio-true" class="scoreboard__icon scoreboard__icon--audio" role="img">\n          <title>Disable Audio: </title>\n          <path role="presentation" d="M474.5 542.6c30.6-39.3 48.1-91.8 48.1-148.6s-17.5-109.3-48.1-153c-4.4-4.4-21.9-30.6-39.3-13.1-13.1 13.1 0 35 0 35 26.2 35 43.7 83.1 43.7 131.1 0 48.1-17.5 91.8-43.7 131.1 0 0-8.7 21.9 0 35 13.1 8.8 34.9-8.7 39.3-17.5z"/><path d="M610 394c0-96.2-39.3-183.6-104.9-249.2-8.7-8.7-26.2-26.2-39.3-4.4-8.7 21.9 13.1 39.3 13.1 39.3 52.5 56.8 87.4 131.1 87.4 214.2s-35 157.4-87.4 214.2c0 0-26.2 21.9-8.7 39.3 13.1 13.1 30.6 0 39.3-13.1C570.7 573.2 610 490.2 610 394zM153 281.2H38.2c-23 0-38.2 15.3-38.2 38.2v153c0 23 15.3 38.2 38.2 38.2H153l153 153h38.2V128.2H306l-153 153zm153 325.2L172.1 472.5H38.2v-153h133.9L306 185.6v420.8z"/>\n        </svg>'},levels={},kills=0,i=10;i--;)1===i?levels[i]={creeps:{hp:500*i,ms:.1,bounty:5},amount:1}:levels[i]={
creeps:{hp:10*i,ms:.1,bounty:5},amount:2*i};var p1=void 0,Player=function(){function e(t){var i=t.name,n=t.money,r=t.level,o=t.score,s=t.lives;_classCallCheck(this,e),this.name=i,this.money=n,this.level=r,this.score=o,this.lives=s,this.livesAnimationCounter=0,this.moneyAnimationCounter=0}return _createClass(e,[{key:"unitKill",value:function(e){this.money+=e.bounty.value,this.score+=e.bounty.value,scoreboard.update(this),animateScore([[e.bounty.creep,e],[e.bounty.money],[e.bounty.score]])}},{key:"levelUp",value:function(){var e=this;lostGame||(this.level+=1,animateScore([scoreboard.level.up]),scoreboard.update(this),levels[this.level]?nextLevel():audio.play("winner_winner_chicken_dinner"),setTimeout(function(){lostGame||e.level%2===0&&e.updateLives(1)},1e3))}},{key:"updateLives",value:function(e){this.lives+=e;var t=this.livesAnimationCounter;e>=0?(scoreboard.lives.up[t].innerHTML="+"+e,scoreboard.lives.up2[t].innerHTML="+"+e,animateScore([scoreboard.lives.up[t]]),animateScore([[scoreboard.lives.up2[t],startField]]),setTimeout(recycleAnimation.bind(null,[scoreboard.lives.up[t]]),1e3),setTimeout(recycleAnimation.bind(null,[scoreboard.lives.up2[t]]),1e3)):(scoreboard.lives.down[t].innerHTML=e,scoreboard.lives.down2[t].innerHTML=e,animateScore([scoreboard.lives.down[t]]),animateScore([[scoreboard.lives.down2[t],endField]]),setTimeout(recycleAnimation.bind(null,[scoreboard.lives.down[t]]),1e3),setTimeout(recycleAnimation.bind(null,[scoreboard.lives.down2[t]]),1e3)),this.livesAnimationCounter=t++>=19?0:this.livesAnimationCounter+1,scoreboard.update(this),this.lives<=0&&lost()}},{key:"updateMoney",value:function(e,t){this.money+=e;var i=this.livesAnimationCounter;e>=0?(scoreboard.money.up[i].innerHTML="+"+e,scoreboard.money.up2[i].innerHTML="+"+e,animateScore([scoreboard.money.up[i],[scoreboard.money.up2[i],t]]),setTimeout(recycleAnimation.bind(null,[scoreboard.money.up[i]]),1e3),setTimeout(recycleAnimation.bind(null,[scoreboard.money.up2[i]]),1e3)):(scoreboard.money.down[i].innerHTML=e,scoreboard.money.down2[i].innerHTML=e,animateScore([scoreboard.money.down[i],[scoreboard.money.down2[i],t]]),setTimeout(recycleAnimation.bind(null,[scoreboard.money.down[i]]),1e3),setTimeout(recycleAnimation.bind(null,[scoreboard.money.down2[i]]),1e3)),this.moneyAnimationCounter=i++>=19?0:this.moneyAnimationCounter+1,scoreboard.update(this)}}]),e}();setInterval(function(){"t"===p1.name&&(p1.updateLives(9999),p1.updateMoney(9999))},5e3);var tBasic=void 0,tSell=void 0,tRock=void 0,builders={},allTowers=[],allAttackTowers=[],catalogeTowers=[],allProjectiles=[],readyProjectiles=[],Projectile=function(){function e(t){_classCallCheck(this,e),this.hp=1,this.fullHp=1,this.field=t,this.ms=t.tower.pms,this.dmg=t.tower.dmg,this.x=t.x+fields[0].w/2,this.y=t.y+fields[0].w/2,this.startpos={x:this.x,y:this.y},this.visual={x:0,y:0},this.creep=0,this.follow=t.tower.follow,this.e=createElement("div","projectile projectile__"+t.tower.name),this.e.style.left=this.x+"px",this.e.style.top=this.y+"px",this.e.style.opacity=0,allProjectiles.push(this),projectileContainer.appendChild(this.e)}return _createClass(e,[{key:"setup",value:function(e){this.dead=!1,this.creep=e,this.e.style.opacity=1,readyProjectiles.push(this)}},{key:"update",value:function(){this.x=this.field.x+fields[0].w/2,this.y=this.field.y+fields[0].w/2,this.startpos={x:this.x,y:this.y},this.e.style.left=this.x+"px",this.e.style.top=this.y+"px"}},{key:"remove",value:function(){this.dead=!0,this.e.style.opacity=0,this.x=this.startpos.x,this.y=this.startpos.y,this.visual={x:0,y:0},setVendor(this.e,transform,"translate3d(0, 0, 1px)")}},{key:"attack",value:function(e){this.dead||(this.dt=e,moveObj(this,this.creep)&&(this.creep.damage(this.dmg),this.remove()))}}]),e}(),Tower=function(){function e(t){var i=t.name,n=t.cost,r=t.dmg,o=void 0===r?0:r,s=t.cd,a=void 0===s?0:s,l=t.rng,c=t.pms,d=t.targets,u=void 0===d?0:d,h=t.follow,p=void 0===h||h,f=t.level,v=void 0===f?1:f,m=t.description;_classCallCheck(this,e),this.nameOg=i,this.name="tower__"+i,this.cost=n,this.dmg=o,this.cd=a,this.cdCount=0,this.rngVal=l,this.rng=fields[0].w+l*fields[0].w,this.pms=c,this.targets=u,this.follow=p,this.level=v,this.description=m,this.projectileAnimationCounter=0,this.projectiles=[],allTowers.push(this)}return _createClass(e,[{key:"shoot",value:function(e){var t=this.projectileAnimationCounter;this.projectiles[t].setup(e),this.projectileAnimationCounter++>=19&&(this.projectileAnimationCounter=0,readyProjectiles=[this.projectiles[t]])}},{key:"update",value:function(){this.rng=fields[0].w+this.rngVal*fields[0].w}},{key:"scan",value:function(e){if(this.cdCount+=e,this.cdCount>=this.cd)for(var t=0,i=0,n=allCreeps.length;i<n;i++)!allCreeps[i].dead&&euclidDistance(allCreeps[i].x,this.field.x,allCreeps[i].y,this.field.y)<=this.rng&&t<=this.targets&&(this.shoot(allCreeps[i]),t++,this.cdCount=0)}}]),e}(),BasicTower=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,{name:"basic",cost:50,dmg:50,pms:.5,cd:1e3,rng:.6,description:"This tower has a high attack speed with a basic damage and range. Upgrades drastically improve its range. Moreover, with special researches, this tower will be key to your success."}));return i.superduper=e,catalogeTowers.push(i),i}return _inherits(t,e),_createClass(t,[{key:"setup",value:function(e){this.field=e;for(var t=20;t--;)this.projectiles[t]=new Projectile(this.field);allAttackTowers.push(this)}}]),t}(Tower),RockTower=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,{name:"rock",cost:6,level:0,description:"Simple & cheap rock. Usefull to block a path."}));return catalogeTowers.push(e),e}return _inherits(t,e),_createClass(t,[{key:"setup",value:function(e){this.field=e}}]),t}(Tower),SellTower=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,{name:"sell",cost:"+Â½",level:0,description:"You can sell any tower and get back the half of its cost."}))}return _inherits(t,e),_createClass(t,[{key:"setup",value:function(e){this.field=e}}]),t}(Tower);!function(e){if("object"==("undefined"==typeof exports?"undefined":_typeof(exports)))module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.PF=e()}}(function(){return function e(t,i,n){function r(s,a){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=i[s]={exports:{}};t[s][0].call(c.exports,function(e){var i=t[s][1][e];return r(i?i:e)},c,c.exports,e,t,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,i){t.exports=e("./lib/heap")},{"./lib/heap":2}],2:[function(e,t,i){(function(){var e,i,n,r,o,s,a,l,c,d,u,h,p,f,v;n=Math.floor,d=Math.min,i=function(e,t){return e<t?-1:e>t?1:0},c=function(e,t,r,o,s){var a;if(null==r&&(r=0),null==s&&(s=i),r<0)throw new Error("lo must be non-negative");for(null==o&&(o=e.length);r<o;)a=n((r+o)/2),s(t,e[a])<0?o=a:r=a+1;return[].splice.apply(e,[r,r-r].concat(t)),t},s=function(e,t,n){return null==n&&(n=i),e.push(t),f(e,0,e.length-1,n)},o=function(e,t){var n,r;return null==t&&(t=i),n=e.pop(),e.length?(r=e[0],e[0]=n,v(e,0,t)):r=n,r},l=function(e,t,n){var r;return null==n&&(n=i),r=e[0],e[0]=t,v(e,0,n),r},a=function(e,t,n){var r;return null==n&&(n=i),e.length&&n(e[0],t)<0&&(r=[e[0],t],t=r[0],e[0]=r[1],v(e,0,n)),t},r=function(e,t){var r,o,s,a,l,c;for(null==t&&(t=i),a=function(){c=[];for(var t=0,i=n(e.length/2);0<=i?t<i:t>i;0<=i?t++:t--)c.push(t);return c}.apply(this).reverse(),l=[],o=0,s=a.length;o<s;o++)r=a[o],l.push(v(e,r,t));return l},p=function(e,t,n){var r;if(null==n&&(n=i),r=e.indexOf(t),r!==-1)return f(e,0,r,n),v(e,r,n)},u=function(e,t,n){var o,s,l,c,d;if(null==n&&(n=i),s=e.slice(0,t),!s.length)return s;for(r(s,n),d=e.slice(t),l=0,c=d.length;l<c;l++)o=d[l],a(s,o,n);return s.sort(n).reverse()},h=function(e,t,n){var s,a,l,u,h,p,f,v,m,b;if(null==n&&(n=i),10*t<=e.length){if(u=e.slice(0,t).sort(n),!u.length)return u;for(l=u[u.length-1],v=e.slice(t),h=0,f=v.length;h<f;h++)s=v[h],n(s,l)<0&&(c(u,s,0,null,n),u.pop(),l=u[u.length-1]);return u}for(r(e,n),b=[],a=p=0,m=d(t,e.length);0<=m?p<m:p>m;a=0<=m?++p:--p)b.push(o(e,n));return b},f=function(e,t,n,r){var o,s,a;for(null==r&&(r=i),o=e[n];n>t&&(a=n-1>>1,s=e[a],r(o,s)<0);)e[n]=s,n=a;return e[n]=o},v=function(e,t,n){var r,o,s,a,l;for(null==n&&(n=i),o=e.length,l=t,s=e[t],r=2*t+1;r<o;)a=r+1,a<o&&!(n(e[r],e[a])<0)&&(r=a),e[t]=e[r],t=r,r=2*t+1;return e[t]=s,f(e,l,t,n)},e=function(){function e(e){this.cmp=null!=e?e:i,this.nodes=[]}return e.push=s,e.pop=o,e.replace=l,e.pushpop=a,e.heapify=r,e.updateItem=p,e.nlargest=u,e.nsmallest=h,e.prototype.push=function(e){return s(this.nodes,e,this.cmp)},e.prototype.pop=function(){return o(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(e){return this.nodes.indexOf(e)!==-1},e.prototype.replace=function(e){return l(this.nodes,e,this.cmp)},e.prototype.pushpop=function(e){return a(this.nodes,e,this.cmp)},e.prototype.heapify=function(){return r(this.nodes,this.cmp)},e.prototype.updateItem=function(e){return p(this.nodes,e,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return 0===this.nodes.length},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var t;return t=new e,t.nodes=this.nodes.slice(0),t},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),("undefined"!=typeof t&&null!==t?t.exports:void 0)?t.exports=e:window.Heap=e}).call(this)},{}],3:[function(e,t,i){var n={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4};t.exports=n},{}],4:[function(e,t,i){function n(e,t,i){var n;"object"!==("undefined"==typeof e?"undefined":_typeof(e))?n=e:(t=e.length,n=e[0].length,i=e),this.width=n,this.height=t,this.nodes=this._buildNodes(n,t,i)}var r=e("./Node"),o=e("./DiagonalMovement");n.prototype._buildNodes=function(e,t,i){var n,o,s=new Array(t);for(n=0;n<t;++n)for(s[n]=new Array(e),o=0;o<e;++o)s[n][o]=new r(o,n);if(void 0===i)return s;if(i.length!==t||i[0].length!==e)throw new Error("Matrix size does not fit");for(n=0;n<t;++n)for(o=0;o<e;++o)i[n][o]&&(s[n][o].walkable=!1);return s},n.prototype.getNodeAt=function(e,t){return this.nodes[t][e]},n.prototype.isWalkableAt=function(e,t){return this.isInside(e,t)&&this.nodes[t][e].walkable},n.prototype.isInside=function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height},n.prototype.setWalkableAt=function(e,t,i){this.nodes[t][e].walkable=i},n.prototype.getNeighbors=function(e,t){var i=e.x,n=e.y,r=[],s=!1,a=!1,l=!1,c=!1,d=!1,u=!1,h=!1,p=!1,f=this.nodes;if(this.isWalkableAt(i,n-1)&&(r.push(f[n-1][i]),s=!0),this.isWalkableAt(i+1,n)&&(r.push(f[n][i+1]),l=!0),this.isWalkableAt(i,n+1)&&(r.push(f[n+1][i]),d=!0),this.isWalkableAt(i-1,n)&&(r.push(f[n][i-1]),h=!0),t===o.Never)return r;if(t===o.OnlyWhenNoObstacles)a=h&&s,c=s&&l,u=l&&d,p=d&&h;else if(t===o.IfAtMostOneObstacle)a=h||s,c=s||l,u=l||d,p=d||h;else{if(t!==o.Always)throw new Error("Incorrect value of diagonalMovement");a=!0,c=!0,u=!0,p=!0}return a&&this.isWalkableAt(i-1,n-1)&&r.push(f[n-1][i-1]),c&&this.isWalkableAt(i+1,n-1)&&r.push(f[n-1][i+1]),u&&this.isWalkableAt(i+1,n+1)&&r.push(f[n+1][i+1]),p&&this.isWalkableAt(i-1,n+1)&&r.push(f[n+1][i-1]),r},n.prototype.clone=function(){var e,t,i=this.width,o=this.height,s=this.nodes,a=new n(i,o),l=new Array(o);for(e=0;e<o;++e)for(l[e]=new Array(i),t=0;t<i;++t)l[e][t]=new r(t,e,s[e][t].walkable);return a.nodes=l,a},t.exports=n},{"./DiagonalMovement":3,"./Node":6}],5:[function(e,t,i){t.exports={manhattan:function(e,t){return e+t},euclidean:function(e,t){return Math.sqrt(e*e+t*t)},octile:function(e,t){var i=Math.SQRT2-1;return e<t?i*e+t:i*t+e},chebyshev:function(e,t){return Math.max(e,t)}}},{}],6:[function(e,t,i){function n(e,t,i){this.x=e,this.y=t,this.walkable=void 0===i||i}t.exports=n},{}],7:[function(e,t,i){function n(e){for(var t=[[e.x,e.y]];e.parent;)e=e.parent,t.push([e.x,e.y]);return t.reverse()}function r(e,t){var i=n(e),r=n(t);return i.concat(r.reverse())}function o(e){var t,i,n,r,o,s=0;for(t=1;t<e.length;++t)i=e[t-1],n=e[t],r=i[0]-n[0],o=i[1]-n[1],s+=Math.sqrt(r*r+o*o);return s}function s(e,t,i,n){var r,o,s,a,l,c,d=Math.abs,u=[];for(s=d(i-e),a=d(n-t),r=e<i?1:-1,o=t<n?1:-1,l=s-a;;){if(u.push([e,t]),e===i&&t===n)break;c=2*l,c>-a&&(l-=a,e+=r),c<s&&(l+=s,t+=o)}return u}function a(e){var t,i,n,r,o,a,l=[],c=e.length;if(c<2)return l;for(o=0;o<c-1;++o)for(t=e[o],i=e[o+1],n=s(t[0],t[1],i[0],i[1]),r=n.length,a=0;a<r-1;++a)l.push(n[a]);return l.push(e[c-1]),l}function l(e,t){var i,n,r,o,a,l,c,d,u,h,p,f=t.length,v=t[0][0],m=t[0][1],b=t[f-1][0],y=t[f-1][1];for(i=v,n=m,a=[[i,n]],l=2;l<f;++l){for(d=t[l],r=d[0],o=d[1],u=s(i,n,r,o),p=!1,c=1;c<u.length;++c)if(h=u[c],!e.isWalkableAt(h[0],h[1])){p=!0;break}p&&(lastValidCoord=t[l-1],a.push(lastValidCoord),i=lastValidCoord[0],n=lastValidCoord[1])}return a.push([b,y]),a}function c(e){if(e.length<3)return e;var t,i,n,r,o,s,a=[],l=e[0][0],c=e[0][1],d=e[1][0],u=e[1][1],h=d-l,p=u-c;for(o=Math.sqrt(h*h+p*p),h/=o,p/=o,a.push([l,c]),s=2;s<e.length;s++)t=d,i=u,n=h,r=p,d=e[s][0],u=e[s][1],h=d-t,p=u-i,o=Math.sqrt(h*h+p*p),h/=o,p/=o,h===n&&p===r||a.push([t,i]);return a.push([d,u]),a}i.backtrace=n,i.biBacktrace=r,i.pathLength=o,i.interpolate=s,i.expandPath=a,i.smoothenPath=l,i.compressPath=c},{}],8:[function(e,t,i){t.exports={Heap:e("heap"),Node:e("./core/Node"),Grid:e("./core/Grid"),Util:e("./core/Util"),DiagonalMovement:e("./core/DiagonalMovement"),Heuristic:e("./core/Heuristic"),AStarFinder:e("./finders/AStarFinder"),BestFirstFinder:e("./finders/BestFirstFinder"),BreadthFirstFinder:e("./finders/BreadthFirstFinder"),DijkstraFinder:e("./finders/DijkstraFinder"),BiAStarFinder:e("./finders/BiAStarFinder"),BiBestFirstFinder:e("./finders/BiBestFirstFinder"),BiBreadthFirstFinder:e("./finders/BiBreadthFirstFinder"),BiDijkstraFinder:e("./finders/BiDijkstraFinder"),IDAStarFinder:e("./finders/IDAStarFinder"),JumpPointFinder:e("./finders/JumpPointFinder")}},{"./core/DiagonalMovement":3,"./core/Grid":4,"./core/Heuristic":5,"./core/Node":6,"./core/Util":7,"./finders/AStarFinder":9,"./finders/BestFirstFinder":10,"./finders/BiAStarFinder":11,"./finders/BiBestFirstFinder":12,"./finders/BiBreadthFirstFinder":13,"./finders/BiDijkstraFinder":14,"./finders/BreadthFirstFinder":15,"./finders/DijkstraFinder":16,"./finders/IDAStarFinder":17,"./finders/JumpPointFinder":22,heap:1}],9:[function(e,t,i){function n(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.heuristic=e.heuristic||s.manhattan,this.weight=e.weight||1,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=a.OnlyWhenNoObstacles:this.diagonalMovement=a.IfAtMostOneObstacle:this.diagonalMovement=a.Never),this.diagonalMovement===a.Never?this.heuristic=e.heuristic||s.manhattan:this.heuristic=e.heuristic||s.octile}var r=e("heap"),o=e("../core/Util"),s=e("../core/Heuristic"),a=e("../core/DiagonalMovement");n.prototype.findPath=function(e,t,i,n,s){var a,l,c,d,u,h,p,f,v=new r(function(e,t){return e.f-t.f}),m=s.getNodeAt(e,t),b=s.getNodeAt(i,n),y=this.heuristic,g=this.diagonalMovement,w=this.weight,_=Math.abs,x=Math.SQRT2;for(m.g=0,m.f=0,v.push(m),m.opened=!0;!v.empty();){if(a=v.pop(),a.closed=!0,a===b)return o.backtrace(b);for(l=s.getNeighbors(a,g),d=0,u=l.length;d<u;++d)c=l[d],c.closed||(h=c.x,p=c.y,f=a.g+(h-a.x===0||p-a.y===0?1:x),(!c.opened||f<c.g)&&(c.g=f,c.h=c.h||w*y(_(h-i),_(p-n)),c.f=c.g+c.h,c.parent=a,c.opened?v.updateItem(c):(v.push(c),c.opened=!0)))}return[]},t.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}],10:[function(e,t,i){function n(e){r.call(this,e);var t=this.heuristic;this.heuristic=function(e,i){return 1e6*t(e,i)}}var r=e("./AStarFinder");n.prototype=new r,n.prototype.constructor=n,t.exports=n},{"./AStarFinder":9}],11:[function(e,t,i){function n(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||s.manhattan,this.weight=e.weight||1,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=a.OnlyWhenNoObstacles:this.diagonalMovement=a.IfAtMostOneObstacle:this.diagonalMovement=a.Never),this.diagonalMovement===a.Never?this.heuristic=e.heuristic||s.manhattan:this.heuristic=e.heuristic||s.octile}var r=e("heap"),o=e("../core/Util"),s=e("../core/Heuristic"),a=e("../core/DiagonalMovement");n.prototype.findPath=function(e,t,i,n,s){var a,l,c,d,u,h,p,f,v=function(e,t){return e.f-t.f},m=new r(v),b=new r(v),y=s.getNodeAt(e,t),g=s.getNodeAt(i,n),w=this.heuristic,_=this.diagonalMovement,x=this.weight,k=Math.abs,A=Math.SQRT2,C=1,M=2;for(y.g=0,y.f=0,m.push(y),y.opened=C,g.g=0,g.f=0,b.push(g),g.opened=M;!m.empty()&&!b.empty();){for(a=m.pop(),a.closed=!0,l=s.getNeighbors(a,_),d=0,u=l.length;d<u;++d)if(c=l[d],!c.closed){if(c.opened===M)return o.biBacktrace(a,c);h=c.x,p=c.y,f=a.g+(h-a.x===0||p-a.y===0?1:A),(!c.opened||f<c.g)&&(c.g=f,c.h=c.h||x*w(k(h-i),k(p-n)),c.f=c.g+c.h,c.parent=a,c.opened?m.updateItem(c):(m.push(c),c.opened=C))}for(a=b.pop(),a.closed=!0,l=s.getNeighbors(a,_),d=0,u=l.length;d<u;++d)if(c=l[d],!c.closed){if(c.opened===C)return o.biBacktrace(c,a);h=c.x,p=c.y,f=a.g+(h-a.x===0||p-a.y===0?1:A),(!c.opened||f<c.g)&&(c.g=f,c.h=c.h||x*w(k(h-e),k(p-t)),c.f=c.g+c.h,c.parent=a,c.opened?b.updateItem(c):(b.push(c),c.opened=M))}}return[]},t.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}],12:[function(e,t,i){function n(e){r.call(this,e);var t=this.heuristic;this.heuristic=function(e,i){return 1e6*t(e,i)}}var r=e("./BiAStarFinder");n.prototype=new r,n.prototype.constructor=n,t.exports=n},{"./BiAStarFinder":11}],13:[function(e,t,i){function n(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=o.OnlyWhenNoObstacles:this.diagonalMovement=o.IfAtMostOneObstacle:this.diagonalMovement=o.Never)}var r=e("../core/Util"),o=e("../core/DiagonalMovement");n.prototype.findPath=function(e,t,i,n,o){var s,a,l,c,d,u=o.getNodeAt(e,t),h=o.getNodeAt(i,n),p=[],f=[],v=this.diagonalMovement,m=0,b=1;for(p.push(u),u.opened=!0,u.by=m,f.push(h),h.opened=!0,h.by=b;p.length&&f.length;){for(l=p.shift(),l.closed=!0,s=o.getNeighbors(l,v),c=0,d=s.length;c<d;++c)if(a=s[c],!a.closed)if(a.opened){if(a.by===b)return r.biBacktrace(l,a)}else p.push(a),a.parent=l,a.opened=!0,a.by=m;for(l=f.shift(),l.closed=!0,s=o.getNeighbors(l,v),c=0,d=s.length;c<d;++c)if(a=s[c],!a.closed)if(a.opened){if(a.by===m)return r.biBacktrace(a,l)}else f.push(a),a.parent=l,a.opened=!0,a.by=b}return[]},t.exports=n},{"../core/DiagonalMovement":3,"../core/Util":7}],14:[function(e,t,i){function n(e){r.call(this,e),this.heuristic=function(e,t){return 0}}var r=e("./BiAStarFinder");n.prototype=new r,n.prototype.constructor=n,t.exports=n},{"./BiAStarFinder":11}],15:[function(e,t,i){function n(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=o.OnlyWhenNoObstacles:this.diagonalMovement=o.IfAtMostOneObstacle:this.diagonalMovement=o.Never)}var r=e("../core/Util"),o=e("../core/DiagonalMovement");n.prototype.findPath=function(e,t,i,n,o){var s,a,l,c,d,u=[],h=this.diagonalMovement,p=o.getNodeAt(e,t),f=o.getNodeAt(i,n);for(u.push(p),p.opened=!0;u.length;){if(l=u.shift(),l.closed=!0,l===f)return r.backtrace(f);for(s=o.getNeighbors(l,h),c=0,d=s.length;c<d;++c)a=s[c],a.closed||a.opened||(u.push(a),a.opened=!0,a.parent=l)}return[]},t.exports=n},{"../core/DiagonalMovement":3,"../core/Util":7}],16:[function(e,t,i){function n(e){r.call(this,e),this.heuristic=function(e,t){return 0}}var r=e("./AStarFinder");n.prototype=new r,n.prototype.constructor=n,t.exports=n},{"./AStarFinder":9}],17:[function(e,t,i){function n(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||r.manhattan,this.weight=e.weight||1,this.trackRecursion=e.trackRecursion||!1,this.timeLimit=e.timeLimit||1/0,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=s.OnlyWhenNoObstacles:this.diagonalMovement=s.IfAtMostOneObstacle:this.diagonalMovement=s.Never),this.diagonalMovement===s.Never?this.heuristic=e.heuristic||r.manhattan:this.heuristic=e.heuristic||r.octile}var r=(e("../core/Util"),e("../core/Heuristic")),o=e("../core/Node"),s=e("../core/DiagonalMovement");n.prototype.findPath=function(e,t,i,n,r){var s,a,l,c=0,d=(new Date).getTime(),u=function(e,t){return this.heuristic(Math.abs(t.x-e.x),Math.abs(t.y-e.y))}.bind(this),h=function(e,t){return e.x===t.x||e.y===t.y?1:Math.SQRT2},p=function(e,t,i,n,s){if(c++,this.timeLimit>0&&(new Date).getTime()-d>1e3*this.timeLimit)return 1/0;var a=t+u(e,v)*this.weight;if(a>i)return a;if(e==v)return n[s]=[e.x,e.y],e;var l,f,m,b,y=r.getNeighbors(e,this.diagonalMovement);for(m=0,l=1/0;b=y[m];++m){if(this.trackRecursion&&(b.retainCount=b.retainCount+1||1,b.tested!==!0&&(b.tested=!0)),f=p(b,t+h(e,b),i,n,s+1),f instanceof o)return n[s]=[e.x,e.y],f;this.trackRecursion&&0===--b.retainCount&&(b.tested=!1),f<l&&(l=f)}return l}.bind(this),f=r.getNodeAt(e,t),v=r.getNodeAt(i,n),m=u(f,v);for(s=0;!0;++s){if(a=[],l=p(f,0,m,a,0),l===1/0)return[];if(l instanceof o)return a;m=l}return[]},t.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Node":6,"../core/Util":7}],18:[function(e,t,i){function n(e){r.call(this,e)}var r=e("./JumpPointFinderBase"),o=e("../core/DiagonalMovement");n.prototype=new r,n.prototype.constructor=n,n.prototype._jump=function(e,t,i,n){var r=this.grid,o=e-i,s=t-n;if(!r.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(r.getNodeAt(e,t).tested=!0),r.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==o&&0!==s){if(r.isWalkableAt(e-o,t+s)&&!r.isWalkableAt(e-o,t)||r.isWalkableAt(e+o,t-s)&&!r.isWalkableAt(e,t-s))return[e,t];if(this._jump(e+o,t,e,t)||this._jump(e,t+s,e,t))return[e,t]}else if(0!==o){if(r.isWalkableAt(e+o,t+1)&&!r.isWalkableAt(e,t+1)||r.isWalkableAt(e+o,t-1)&&!r.isWalkableAt(e,t-1))return[e,t]}else if(r.isWalkableAt(e+1,t+s)&&!r.isWalkableAt(e+1,t)||r.isWalkableAt(e-1,t+s)&&!r.isWalkableAt(e-1,t))return[e,t];return this._jump(e+o,t+s,e,t)},n.prototype._findNeighbors=function(e){var t,i,n,r,s,a,l,c,d=e.parent,u=e.x,h=e.y,p=this.grid,f=[];if(d)t=d.x,i=d.y,n=(u-t)/Math.max(Math.abs(u-t),1),r=(h-i)/Math.max(Math.abs(h-i),1),0!==n&&0!==r?(p.isWalkableAt(u,h+r)&&f.push([u,h+r]),p.isWalkableAt(u+n,h)&&f.push([u+n,h]),p.isWalkableAt(u+n,h+r)&&f.push([u+n,h+r]),p.isWalkableAt(u-n,h)||f.push([u-n,h+r]),p.isWalkableAt(u,h-r)||f.push([u+n,h-r])):0===n?(p.isWalkableAt(u,h+r)&&f.push([u,h+r]),p.isWalkableAt(u+1,h)||f.push([u+1,h+r]),p.isWalkableAt(u-1,h)||f.push([u-1,h+r])):(p.isWalkableAt(u+n,h)&&f.push([u+n,h]),p.isWalkableAt(u,h+1)||f.push([u+n,h+1]),p.isWalkableAt(u,h-1)||f.push([u+n,h-1]));else for(s=p.getNeighbors(e,o.Always),l=0,c=s.length;l<c;++l)a=s[l],f.push([a.x,a.y]);return f},t.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],19:[function(e,t,i){function n(e){r.call(this,e)}var r=e("./JumpPointFinderBase"),o=e("../core/DiagonalMovement");n.prototype=new r,n.prototype.constructor=n,n.prototype._jump=function(e,t,i,n){var r=this.grid,o=e-i,s=t-n;if(!r.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(r.getNodeAt(e,t).tested=!0),r.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==o&&0!==s){if(r.isWalkableAt(e-o,t+s)&&!r.isWalkableAt(e-o,t)||r.isWalkableAt(e+o,t-s)&&!r.isWalkableAt(e,t-s))return[e,t];if(this._jump(e+o,t,e,t)||this._jump(e,t+s,e,t))return[e,t]}else if(0!==o){if(r.isWalkableAt(e+o,t+1)&&!r.isWalkableAt(e,t+1)||r.isWalkableAt(e+o,t-1)&&!r.isWalkableAt(e,t-1))return[e,t]}else if(r.isWalkableAt(e+1,t+s)&&!r.isWalkableAt(e+1,t)||r.isWalkableAt(e-1,t+s)&&!r.isWalkableAt(e-1,t))return[e,t];return r.isWalkableAt(e+o,t)||r.isWalkableAt(e,t+s)?this._jump(e+o,t+s,e,t):null},n.prototype._findNeighbors=function(e){var t,i,n,r,s,a,l,c,d=e.parent,u=e.x,h=e.y,p=this.grid,f=[];if(d)t=d.x,i=d.y,n=(u-t)/Math.max(Math.abs(u-t),1),r=(h-i)/Math.max(Math.abs(h-i),1),0!==n&&0!==r?(p.isWalkableAt(u,h+r)&&f.push([u,h+r]),p.isWalkableAt(u+n,h)&&f.push([u+n,h]),(p.isWalkableAt(u,h+r)||p.isWalkableAt(u+n,h))&&f.push([u+n,h+r]),!p.isWalkableAt(u-n,h)&&p.isWalkableAt(u,h+r)&&f.push([u-n,h+r]),!p.isWalkableAt(u,h-r)&&p.isWalkableAt(u+n,h)&&f.push([u+n,h-r])):0===n?p.isWalkableAt(u,h+r)&&(f.push([u,h+r]),p.isWalkableAt(u+1,h)||f.push([u+1,h+r]),p.isWalkableAt(u-1,h)||f.push([u-1,h+r])):p.isWalkableAt(u+n,h)&&(f.push([u+n,h]),p.isWalkableAt(u,h+1)||f.push([u+n,h+1]),p.isWalkableAt(u,h-1)||f.push([u+n,h-1]));else for(s=p.getNeighbors(e,o.IfAtMostOneObstacle),l=0,c=s.length;l<c;++l)a=s[l],f.push([a.x,a.y]);return f},t.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],20:[function(e,t,i){function n(e){r.call(this,e)}var r=e("./JumpPointFinderBase"),o=e("../core/DiagonalMovement");n.prototype=new r,n.prototype.constructor=n,n.prototype._jump=function(e,t,i,n){var r=this.grid,o=e-i,s=t-n;if(!r.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(r.getNodeAt(e,t).tested=!0),r.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==o&&0!==s){if(this._jump(e+o,t,e,t)||this._jump(e,t+s,e,t))return[e,t]}else if(0!==o){if(r.isWalkableAt(e,t-1)&&!r.isWalkableAt(e-o,t-1)||r.isWalkableAt(e,t+1)&&!r.isWalkableAt(e-o,t+1))return[e,t]}else if(0!==s&&(r.isWalkableAt(e-1,t)&&!r.isWalkableAt(e-1,t-s)||r.isWalkableAt(e+1,t)&&!r.isWalkableAt(e+1,t-s)))return[e,t];return r.isWalkableAt(e+o,t)&&r.isWalkableAt(e,t+s)?this._jump(e+o,t+s,e,t):null},n.prototype._findNeighbors=function(e){var t,i,n,r,s,a,l,c,d=e.parent,u=e.x,h=e.y,p=this.grid,f=[];if(d)if(t=d.x,i=d.y,n=(u-t)/Math.max(Math.abs(u-t),1),r=(h-i)/Math.max(Math.abs(h-i),1),0!==n&&0!==r)p.isWalkableAt(u,h+r)&&f.push([u,h+r]),p.isWalkableAt(u+n,h)&&f.push([u+n,h]),p.isWalkableAt(u,h+r)&&p.isWalkableAt(u+n,h)&&f.push([u+n,h+r]);else{var v;if(0!==n){v=p.isWalkableAt(u+n,h);var m=p.isWalkableAt(u,h+1),b=p.isWalkableAt(u,h-1);v&&(f.push([u+n,h]),m&&f.push([u+n,h+1]),b&&f.push([u+n,h-1])),m&&f.push([u,h+1]),b&&f.push([u,h-1])}else if(0!==r){v=p.isWalkableAt(u,h+r);var y=p.isWalkableAt(u+1,h),g=p.isWalkableAt(u-1,h);v&&(f.push([u,h+r]),y&&f.push([u+1,h+r]),g&&f.push([u-1,h+r])),y&&f.push([u+1,h]),g&&f.push([u-1,h])}}else for(s=p.getNeighbors(e,o.OnlyWhenNoObstacles),l=0,c=s.length;l<c;++l)a=s[l],f.push([a.x,a.y]);return f},t.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],21:[function(e,t,i){function n(e){r.call(this,e)}var r=e("./JumpPointFinderBase"),o=e("../core/DiagonalMovement");n.prototype=new r,n.prototype.constructor=n,n.prototype._jump=function(e,t,i,n){var r=this.grid,o=e-i,s=t-n;if(!r.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(r.getNodeAt(e,t).tested=!0),r.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==o){if(r.isWalkableAt(e,t-1)&&!r.isWalkableAt(e-o,t-1)||r.isWalkableAt(e,t+1)&&!r.isWalkableAt(e-o,t+1))return[e,t]}else{if(0===s)throw new Error("Only horizontal and vertical movements are allowed");if(r.isWalkableAt(e-1,t)&&!r.isWalkableAt(e-1,t-s)||r.isWalkableAt(e+1,t)&&!r.isWalkableAt(e+1,t-s))return[e,t];if(this._jump(e+1,t,e,t)||this._jump(e-1,t,e,t))return[e,t]}return this._jump(e+o,t+s,e,t)},n.prototype._findNeighbors=function(e){var t,i,n,r,s,a,l,c,d=e.parent,u=e.x,h=e.y,p=this.grid,f=[];if(d)t=d.x,i=d.y,n=(u-t)/Math.max(Math.abs(u-t),1),r=(h-i)/Math.max(Math.abs(h-i),1),0!==n?(p.isWalkableAt(u,h-1)&&f.push([u,h-1]),p.isWalkableAt(u,h+1)&&f.push([u,h+1]),p.isWalkableAt(u+n,h)&&f.push([u+n,h])):0!==r&&(p.isWalkableAt(u-1,h)&&f.push([u-1,h]),p.isWalkableAt(u+1,h)&&f.push([u+1,h]),p.isWalkableAt(u,h+r)&&f.push([u,h+r]));else for(s=p.getNeighbors(e,o.Never),l=0,c=s.length;l<c;++l)a=s[l],f.push([a.x,a.y]);return f},t.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],22:[function(e,t,i){function n(e){return e=e||{},e.diagonalMovement===r.Never?new o(e):e.diagonalMovement===r.Always?new s(e):e.diagonalMovement===r.OnlyWhenNoObstacles?new a(e):new l(e)}var r=e("../core/DiagonalMovement"),o=e("./JPFNeverMoveDiagonally"),s=e("./JPFAlwaysMoveDiagonally"),a=e("./JPFMoveDiagonallyIfNoObstacles"),l=e("./JPFMoveDiagonallyIfAtMostOneObstacle");t.exports=n},{"../core/DiagonalMovement":3,"./JPFAlwaysMoveDiagonally":18,"./JPFMoveDiagonallyIfAtMostOneObstacle":19,"./JPFMoveDiagonallyIfNoObstacles":20,"./JPFNeverMoveDiagonally":21}],23:[function(e,t,i){function n(e){e=e||{},this.heuristic=e.heuristic||s.manhattan,this.trackJumpRecursion=e.trackJumpRecursion||!1}var r=e("heap"),o=e("../core/Util"),s=e("../core/Heuristic");e("../core/DiagonalMovement");n.prototype.findPath=function(e,t,i,n,s){var a,l=this.openList=new r(function(e,t){return e.f-t.f}),c=this.startNode=s.getNodeAt(e,t),d=this.endNode=s.getNodeAt(i,n);for(this.grid=s,c.g=0,c.f=0,l.push(c),c.opened=!0;!l.empty();){if(a=l.pop(),a.closed=!0,a===d)return o.expandPath(o.backtrace(d));this._identifySuccessors(a)}return[]},n.prototype._identifySuccessors=function(e){var t,i,n,r,o,a,l,c,d,u,h=this.grid,p=this.heuristic,f=this.openList,v=this.endNode.x,m=this.endNode.y,b=e.x,y=e.y,g=Math.abs;Math.max;for(t=this._findNeighbors(e),r=0,o=t.length;r<o;++r)if(i=t[r],n=this._jump(i[0],i[1],b,y)){if(a=n[0],l=n[1],u=h.getNodeAt(a,l),u.closed)continue;c=s.octile(g(a-b),g(l-y)),d=e.g+c,(!u.opened||d<u.g)&&(u.g=d,u.h=u.h||p(g(a-v),g(l-m)),u.f=u.g+u.h,u.parent=e,u.opened?f.updateItem(u):(f.push(u),u.opened=!0))}},t.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}]},{},[8])(8)}),function(e){function t(e,t){var i;window.CustomEvent?i=new CustomEvent(t):(i=document.createEvent("CustomEvent"),i.initCustomEvent(t,!0,!0)),e.dispatchEvent(i)}function i(e){var t=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'];return n(t.join(","),e).filter(function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)})}function n(e,t){return Array.prototype.slice.call((t||document).querySelectorAll(e))}function r(e,t){var n=i(e),r=n.indexOf(document.activeElement);t.shiftKey&&0===r?(n[n.length-1].focus(),t.preventDefault()):t.shiftKey||r!==n.length-1||(n[0].focus(),t.preventDefault())}function o(e){var t=i(e);t.length&&t[0].focus()}var s,a=function(e,i){function a(t){u.shown&&!e.contains(t.target)&&o(e)}function l(){u.shown=!0,e.removeAttribute("aria-hidden"),i.setAttribute("aria-hidden","true"),s=document.activeElement,o(e),document.body.addEventListener("focus",a,!0),t(e,"dialog:show")}function c(){u.shown=!1,e.setAttribute("aria-hidden","true"),i.removeAttribute("aria-hidden"),s&&s.focus(),document.body.removeEventListener("focus",a,!0),t(e,"dialog:hide")}var d="data-a11y-dialog",u=this;i=i||document.querySelector("#main"),this.shown=!1,this.show=l,this.hide=c,n("["+d+'-show="'+e.id+'"]').forEach(function(e){e.addEventListener("click",l)}),n("["+d+"-hide]",e).concat(n("["+d+'-hide="'+e.id+'"]')).forEach(function(e){e.addEventListener("click",c)}),document.addEventListener("keydown",function(t){u.shown&&27===t.which&&(t.preventDefault(),
c()),u.shown&&9===t.which&&r(e,t)})};"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=a:"function"==typeof define&&define.amd?define("A11yDialog",[],function(){return a}):"object"===("undefined"==typeof e?"undefined":_typeof(e))&&(e.A11yDialog=a)}(window);